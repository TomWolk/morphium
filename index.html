<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Morphium by sboesebeck</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-44944168-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/sboesebeck/morphium">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/sboesebeck/morphium/archive/V3.1.7.zip">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/sboesebeck/morphium/releases/download/V3.1.7/morphium-3.1.7.jar">JAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>Morphium</h1>
          <p>Morphium - Java Object Mapper and Caching Layer for MongoDB</p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/sboesebeck">sboesebeck</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></span>
        </div>

        <h1>

<img src="http://sboesebeck.github.io/morphium/images/MorphiumLogo.png"/>
<p><a name="morphium" class="anchor" href="#morphium"><span class="octicon octicon-link"></span></a>Morphium - Java Object Mapper and Caching Layer for MongoDB</h1></p>
<p><a href="https://join.slack.com/t/team-morphium/shared_invite/enQtMjgwODMzMzEzMTU5LTA1MjdmZmM5YTM3NjRmZTE2ZGE4NDllYTA0NTUzYjU2MzkxZTJhODlmZGQ2MThjMGY0NmRkMWE1NDE2YmQxYjI"> NEW: Join us at SLACK</a></p>
<p>Morphium is a POJO Object mapper for Accessing Mongodb. Some of the main Features of Morphium:</p>
<ul>
<li>actively developed</li>
<li>used by a number of projects (including holidayinsider.com)</li>
<li>Transparent access to mongo db</li>
<li>Transparent declarative (Annotation based) caching </li>
<li>Annotation based definition of mappings</li>
<li>Cluster Awareness </li>
<li>Cache synchronization between cluster nodes</li>
<li>Asynchronous and Buffered write access</li>
<li>blazing fast Mongodb based Messaging - used for CacheSynchronization - with support for broadcast messages, that are only processed by one node (exclusive messages). Roundtrip in Production environment about 20ms!</li>
<li>fluent interface for querying mongodb</li>
<li>support for the mongodb aggrgator framework</li>
<li>support for complex queries</li>
<li>support inheritence and polymorphism</li>
<li>support for javax.validation annotations</li>
<li>lifecycle method of pojos</li>
<li><a href="https://github.com/sboesebeck/morphium/wiki/Morphium-paged-Iterator">Iterator</a> support for iterating over large collections. Including threadsafe access and support for prefetching (V2.2.5)
<li><a href="https://github.com/sboesebeck/morphium/wiki/Polymorphism">polymorphism</a> support</li>
<li>nearly every aspect of morphium can be replaced by own implementation (e.g. Query-Object, CacheImplementation...)</li>
<li>Spport for References, including lazy loaded references</li>
<li>Support for partial updated objects (when writing, only the changes of the object are transferred)</li>
<li>Morphium is internally implemented asynchronous capable. That means, almost any operation you call via morphium can be executed asynchronously. If there is a AsyncOperaionListener that can be passed on as an argument to the function, you will receive the result via the callback, not directly as return value (or, when it is an update, you will get the exception or the sucess notification)</li>
</ul>
take a look at the <a href="https://github.com/sboesebeck/morphium/wiki/_pages">wiki</a> for more info or read the detailled documentation <a href="http://www.boesebeck.name/?p=899">here</a><br>
<h1>Morphium 3.0 overview</h1>
<a href="https://raw.githubusercontent.com/sboesebeck/morphium/master/Morphium_overview.png"><img src="https://raw.githubusercontent.com/sboesebeck/morphium/master/Morphium_overview.png" size="50%"/></a>

<h1>New MorphiumDriver API</h1>
<p>With 3.0 we introduced the MorphiumDriver API into morphium. This abstracts the whole connection process to the driver layer. Everything is encapsulated - and due to this encapsulation, you can also connect to different things, not only Mongo.</p>
<p>there are different implementation of the MorphiumDriver interface already part of the project. There is the "default"-Driver, which uses the official Mongodb implementation to connect to mongo,
then there are some Test Implementations of own Drivers (SingleConnectDriver, SingleConnectDriverThreadded and one Driver called MetaDriver) and an InMemoryDriver, which is really helpful when testing things.</p>

<p>In future, there will be more drivers in different projects, like <a href="https://github.com/sboesebeck/influxDBMorphiumDriver">here</a>. This is a MorphiumDriver implementation for InfluxDB.</p>
<h1>
<a name="quick-start" class="anchor" href="#quick-start"><span class="octicon octicon-link"></span></a>Quick Start</h1>

<p>before accessing mongo via morphium, you need to configure morphium. this is done by preparing a MorphiumConfig Object:</p>

<div class="highlight highlight-java"><pre>  <span class="n">MorphiumConfig</span> <span class="n">cfg</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MorphiumConfig</span><span class="o">();</span>
  <span class="n">cfg</span><span class="o">.</span><span class="na">setDatabase</span><span class="o">(</span><span class="s">"testdb"</span><span class="o">);</span>
  <span class="n">cfg</span><span class="o">.</span><span class="na">addHost</span><span class="o">(</span><span class="s">"localhost"</span><span class="o">,</span> <span class="mi">27017</span><span class="o">);</span>
</pre></div>

<p>you can also configure morphium using properties: new MorphiumConfig(properties); or a json-String: MorphiumConfig cfg = MorphiumConfig.createFromJson(json);</p>

<p>After that, you just need to instancieate morphium:</p>

<pre><code>  Morphium m=new Morphium(cfg);
</code></pre>

<p>then you are good to go:</p>

<div class="highlight highlight-java"><pre>  <span class="n">Query</span><span class="o">&lt;</span><span class="n">MyEntity</span><span class="o">&gt;</span> <span class="n">q</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="na">createQueryFor</span><span class="o">(</span><span class="n">MyEntity</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">f</span><span class="o">(</span><span class="s">"a_field"</span><span class="o">).</span><span class="na">eq</span><span class="o">(</span><span class="s">"a value"</span><span class="o">);</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">MyEntity</span><span class="o">&gt;</span> <span class="n">lst</span><span class="o">=</span><span class="n">q</span><span class="o">.</span><span class="na">asList</span><span class="o">();</span>
  <span class="n">MyEntity</span> <span class="n">ent</span><span class="o">=</span><span class="n">q</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
  <span class="o">...</span>
  <span class="n">m</span><span class="o">.</span><span class="na">store</span><span class="o">(</span><span class="n">ent</span><span class="o">);</span>
</pre></div>

<p>Defining an Entity is quite simple as well:</p>

<div class="highlight highlight-java"><pre>  <span class="nd">@Entity</span><span class="o">(</span><span class="n">translateCamelCase</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
  <span class="nd">@Cache</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyEntity</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="n">ObjectId</span> <span class="n">myId</span><span class="o">;</span> 

    <span class="kd">private</span> <span class="n">String</span> <span class="n">aField</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">EmbeddedObject</span> <span class="n">emb</span><span class="o">;</span>

    <span class="nd">@Reference</span>
    <span class="kd">private</span> <span class="n">MyEntity</span> <span class="n">otherEntity</span><span class="o">;</span>

   <span class="o">...</span>
  <span class="o">}</span>

  <span class="nd">@Embedded</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmbeddedObject</span> <span class="o">{</span>
   <span class="o">...</span>
  <span class="o">}</span>
</pre></div>

<p>All entities need to have an <a href="https://github.com/Id" class="user-mention">@Id</a> field. If the type is org.bson.types.ObjectId, it will be created by mongo, if not - you need to take care of that.
References only work to other entities (of course).
You can also use Maps, Lists or Arrays, all may also include other Entities or Embedded types.</p>

<h2>
<a name="use-enum-instead-of-strings-for-queries" class="anchor" href="#use-enum-instead-of-strings-for-queries"><span class="octicon octicon-link"></span></a>Use enum instead of strings for queries</h2>

<p>As using strings to query your object might be a bit error prone, you also can use enums instead of field name strings:</p>

<div class="highlight highlight-java"><pre>   <span class="n">Query</span><span class="o">&lt;</span><span class="n">MyEntity</span><span class="o">&gt;</span> <span class="n">q</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="na">createQueryFor</span><span class="o">(</span><span class="n">MyEntity</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">f</span><span class="o">(</span><span class="n">MyEntity</span><span class="o">.</span><span class="na">Fields</span><span class="o">.</span><span class="na">aField</span><span class="o">).</span><span class="na">eq</span><span class="o">(</span><span class="s">"a value"</span><span class="o">);</span>
</pre></div>

<p>of course, these enums need to be created. have a look at <a href="https://github.com/sboesebeck/intelliJGenPropertyEnumsPlugin">https://github.com/sboesebeck/intelliJGenPropertyEnumsPlugin</a> for a plugin for generating those automatically
in our example, the result would look like this:</p>

<div class="highlight highlight-java"><pre>  <span class="nd">@Entity</span><span class="o">(</span><span class="n">translateCamelCase</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
  <span class="nd">@Cache</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyEntity</span> <span class="o">{</span>
    <span class="nd">@Id</span>
    <span class="kd">private</span> <span class="n">ObjectId</span> <span class="n">myId</span><span class="o">;</span> 

    <span class="kd">private</span> <span class="n">String</span> <span class="n">aField</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">EmbeddedObject</span> <span class="n">emb</span><span class="o">;</span>

    <span class="nd">@Reference</span>
    <span class="kd">private</span> <span class="n">MyEntity</span> <span class="n">otherEntity</span><span class="o">;</span>
    <span class="o">...</span>
    <span class="kd">public</span> <span class="kd">enum</span> <span class="n">Fields</span> <span class="o">{</span> <span class="n">myId</span><span class="o">,</span> <span class="n">aField</span><span class="o">,</span> <span class="n">emb</span><span class="o">,</span> <span class="n">otherEntity</span> <span class="o">}</span>

  <span class="o">}</span>

  <span class="nd">@Embedded</span>
  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">EmbeddedObject</span> <span class="o">{</span>
   <span class="o">...</span>
  <span class="o">}</span>
</pre></div>

<p>This is a very short glance at all the features of Morphium!</p>

<p>For more information take a closer look at the <a href="https://github.com/sboesebeck/morphium/wiki">wiki</a> or read the detailled documentation <a href="http://www.boesebeck.name/?p=899">here</a></p>

<p>Have fun,</p>

<p>Stephan</p>
      </section>

<p>PS: some words about Mongodb 3.0 and WiredTiger</p>
<ulist>
  <li>3.0 Ready - V2.2.x works fine with mongodb 3.0, storageEnging wiredTiger is a bit slower than the standard engine in morphiums test suite. It seems like the performance on WiredTiger is a bit slower due to the access pattern morphiums test suite uses. In prooductional environments performance is as expected. Eg. writing performance is way better with wired tiger. Probably it is possible to configure WT to work as performant as MMAPV1 for morphium's test suite, but that is actually not important!
  </li>
  <li>When using WiredTiger storage engine, make sure the settings are configured to your needs, otherwise performance might suffer</li>

</ulist>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>
